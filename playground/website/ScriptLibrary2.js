// ScriptLibrary2.js
(function(){
Type.registerNamespace('LightModel');LightModel.ConsoleColor=function(){};LightModel.ConsoleColor.prototype = {black:0,darkBlue:1,darkGreen:2,darkCyan:3,darkRed:4,darkMagenta:5,darkYellow:6,gray:7,darkGray:8,blue:9,green:10,cyan:11,red:12,magenta:13,yellow:14,white:15}
LightModel.ConsoleColor.registerEnum('LightModel.ConsoleColor',false);LightModel.Application=function(args){LightModel.Application.initializeBase(this);if(args.length<2){throw new Error('to few elements in args');}var $0=new Array(args.length-1);for(var $1=0;$1<args.length-1;$1++){$0[$1]=args[$1];}this.set_a((args.length===2)?Type.safeCast(LightModel.List.ieFirst(args),LightModel.Node):LightModel.Node.createApplication($0));this.set_b(args[args.length-1]);}
LightModel.Application.prototype={_a:null,_b:null,get_a:function(){return this._a;},set_a:function(value){this._a=value;return value;},get_b:function(){return this._b;},set_b:function(value){this._b=value;return value;},get_reducible:function(){return true;},call:function(argument){return new LightModel.Node(new LightModel.Application([new LightModel.Node(this),argument]));},get_readableHuman:function(){return this.reduce().get_readableHuman();},get_complexity:function(){return this.get_a().get_complexity()+this.get_b().get_complexity()+1;}}
LightModel.BuiltInExpression=function(){LightModel.BuiltInExpression.initializeBase(this);}
LightModel.BuiltInExpression.prototype={get_readableHuman:function(){return Type.getInstanceType(this).get_name();},get_complexity:function(){return 1;}}
LightModel.CombinatorEnvironment=function(){LightModel.CombinatorEnvironment.initializeBase(this);this.$0();}
LightModel.CombinatorEnvironment.prototype={$0:function(){this.$1={};},boost:function(ind,alternative){if(!Object.keyExists(this.$1,ind)){this.$1[ind]=alternative;}else{this.$1[ind].boost(alternative);}},$1:null,call:function(argument){var $0=argument.getOutput();if(!Object.keyExists(this.$1,$0)){return this.get_item('maybeNothing');}return LightModel.Node.createApplication2(this.get_item('maybeReturn'),this.get_item($0));},get_complexity:function(){return 1;},get_readableHuman:function(){return '<env mapping>';},get_item:function(ind){if(!Object.keyExists(this.$1,ind)){throw new Error('key not found');}else{return this.$1[ind];}},set_item:function(ind,value){this.$1[ind]=value;return value;}}
LightModel.B=function(){LightModel.B.initializeBase(this);}
LightModel.B.prototype={call:function(argument){return new LightModel._B1(argument).asNode();}}
LightModel._B1=function(x){LightModel._B1.initializeBase(this);this.x=x;}
LightModel._B1.prototype={x:null,call:function($p0){return new LightModel._B2(this.x,$p0).asNode();}}
LightModel._B2=function(x,y){LightModel._B2.initializeBase(this);this.x=x;this.y=y;}
LightModel._B2.prototype={x:null,y:null,call:function($p0){return LightModel.Node.createApplication2(this.x,LightModel.Node.createApplication2(this.y,$p0));}}
LightModel.And=function(){LightModel.And.initializeBase(this);}
LightModel.And.prototype={call:function(argument){return new LightModel._And1(argument).asNode();}}
LightModel._And1=function(operand){LightModel._And1.initializeBase(this);this.$0=operand;}
LightModel._And1.prototype={$0:null,call:function($p0){return LightModel.Bool.getBool(LightModel.Bool.valueOfNode(this.$0)&&LightModel.Bool.valueOfNode($p0));}}
LightModel.Bool=function(number){LightModel.Bool.initializeBase(this);this.set_value(number);}
LightModel.Bool.valueOfNode=function(node){node.reduce();if(Type.canCast(node.get_expression(),LightModel.Bool)){var $0=Type.safeCast(node.get_expression(),LightModel.Bool);return $0.get_value();}return LightModel.Node.createApplication3(node,LightModel.Hook.dummy.asNode(),node).get_reducedForm().get_expression()===LightModel.Hook.dummy;}
LightModel.Bool.getBool=function(b){return (b)?LightModel.Bool.trueX:LightModel.Bool.falseX;}
LightModel.Bool.prototype={$0:false,get_value:function(){return this.$0;},set_value:function(value){this.$0=value;return value;},call:function(argument){return new LightModel._Bool1(this.get_value(),argument).asNode();},get_readableHuman:function(){return (this.$0)?'true':'false';}}
LightModel._Bool1=function(value,first){LightModel._Bool1.initializeBase(this);this.$0=value;this.$1=first;}
LightModel._Bool1.prototype={$0:false,$1:null,call:function($p0){return (this.$0)?this.$1:$p0;}}
LightModel.Not=function(){LightModel.Not.initializeBase(this);}
LightModel.Not.prototype={call:function(argument){return LightModel.Bool.getBool(!LightModel.Bool.valueOfNode(argument));}}
LightModel.Or=function(){LightModel.Or.initializeBase(this);}
LightModel.Or.prototype={call:function(argument){return new LightModel._Or1(argument).asNode();}}
LightModel._Or1=function(operand){LightModel._Or1.initializeBase(this);this.$0=operand;}
LightModel._Or1.prototype={$0:null,call:function($p0){return LightModel.Bool.getBool(LightModel.Bool.valueOfNode(this.$0)||LightModel.Bool.valueOfNode($p0));}}
LightModel.C=function(){LightModel.C.initializeBase(this);}
LightModel.C.prototype={call:function(argument){return new LightModel._C1(argument).asNode();}}
LightModel._C1=function(x){LightModel._C1.initializeBase(this);this.x=x;}
LightModel._C1.prototype={x:null,call:function($p0){return new LightModel._C2(this.x,$p0).asNode();}}
LightModel._C2=function(x,y){LightModel._C2.initializeBase(this);this.x=x;this.y=y;}
LightModel._C2.prototype={x:null,y:null,call:function($p0){return LightModel.Node.createApplication3(this.x,$p0,this.y);}}
LightModel.I=function(){LightModel.I.initializeBase(this);}
LightModel.I.prototype={call:function(argument){return argument;}}
LightModel.K=function(){LightModel.K.initializeBase(this);}
LightModel.K.prototype={call:function(argument){return new LightModel.Node(new LightModel._K1(argument));}}
LightModel._K1=function(x){LightModel._K1.initializeBase(this);this.x=x;}
LightModel._K1.prototype={x:null,call:function($p0){return this.x;}}
LightModel.ListTail=function(){LightModel.ListTail.initializeBase(this);}
LightModel.ListTail.prototype={call:function(argument){return new LightModel.List(LightModel.List.ieTail(LightModel.List.valueOfNode(argument))).asNode();}}
LightModel.ListHead=function(){LightModel.ListHead.initializeBase(this);}
LightModel.ListHead.prototype={call:function(argument){return LightModel.List.ieFirst(LightModel.List.valueOfNode(argument));}}
LightModel.ListSkip=function(){LightModel.ListSkip.initializeBase(this);}
LightModel.ListSkip.prototype={call:function(argument){return new LightModel._ListSkip1(argument).asNode();}}
LightModel._ListSkip1=function(operand){LightModel._ListSkip1.initializeBase(this);this.$0=operand;}
LightModel._ListSkip1.prototype={$0:null,call:function($p0){return new LightModel.List(LightModel.List.ieSkip(LightModel.List.valueOfNode(this.$0),LightModel.NatNumber.valueOfNode($p0))).asNode();}}
LightModel.TailEnumerable=function(subject,skip){this.$0=subject;this.$1=skip;}
LightModel.TailEnumerable.prototype={$0:null,$1:0,getEnumerator:function(){return new LightModel.TailEnumerator(this.$0.getEnumerator(),this.$1);}}
LightModel.TailEnumerator=function(subject,skip){this.$0=subject;this.$1=skip;this.reset();}
LightModel.TailEnumerator.prototype={$0:null,$1:0,current:null,moveNext:function(){var $0=this.$0.moveNext();this.current=this.$0.current;return $0;},reset:function(){this.$0.reset();for(var $0=0;$0<this.$1;$0++){this.$0.moveNext();}}}
LightModel.DeferredTailEnumerable=function(first,tail){this.$0=first;this.$1=tail;}
LightModel.DeferredTailEnumerable.prototype={$0:null,$1:null,getEnumerator:function(){return new LightModel.DeferredTailEnumerator(this);}}
LightModel.DeferredTailEnumerator=function(host){this.$0=host;this.reset();}
LightModel.DeferredTailEnumerator.prototype={$0:null,current:null,$1:null,moveNext:function(){if(this.$1==null){return false;}this.current=this.$1.$0;if(this.current==null){return false;}this.$1=this.$1.$1();return true;},reset:function(){this.current=null;this.$1=this.$0;}}
LightModel.List=function(list){LightModel.List.initializeBase(this);this.$1=list;this.f=new LightModel._LazyNode(function(){
return LightModel.Bool.getBool(LightModel.List.ieAny(list));});this.s=new LightModel._LazyNode(function(){
return (LightModel.List.ieAny(list))?new LightModel._Cons(LightModel.List.ieFirst(list),LightModel.List.ieTail(list)).asNode():LightModel.I.instance;});}
LightModel.List.$0=function($p0){$p0.reduce();if(!LightModel.Bool.valueOfNode(LightModel.Pair.getFirst($p0))){return new LightModel.DeferredTailEnumerable(null,null);}var $0=LightModel.Pair.getSecond($p0);return new LightModel.DeferredTailEnumerable(LightModel.Pair.getFirst($0),function(){
return LightModel.List.$0(LightModel.Pair.getSecond($0));});}
LightModel.List.valueOfNode=function(node){node.reduce();if(Type.canCast(node.get_expression(),LightModel.List)){var $1=Type.safeCast(node.get_expression(),LightModel.List);return $1.$1;}var $0=LightModel.List.$0(node);node.boost(new LightModel.List($0).asNode());return $0;}
LightModel.List.ieAny=function(list){var $enum1=ss.IEnumerator.getEnumerator(list);while($enum1.moveNext()){var $0=$enum1.current;return true;}return false;}
LightModel.List.ieFirst=function(list){var $enum1=ss.IEnumerator.getEnumerator(list);while($enum1.moveNext()){var $0=$enum1.current;return $0;}throw new Error('cannot get first element of empty list');}
LightModel.List.ieTail=function(list){return LightModel.List.ieSkip(list,1);}
LightModel.List.ieSkip=function(list,count){return new LightModel.TailEnumerable(list,count);}
LightModel.List.fromString=function(s){var $0=[];for(var $1=0;$1<s.length;$1++){$0.add(new LightModel.NatNumber(s.charCodeAt($1)).asNode());}return new LightModel.List($0).asNode();}
LightModel.List.prototype={$1:null,f:null,get_first:function(){return this.f.get_$3();},s:null,get_second:function(){return this.s.get_$3();}}
LightModel._Cons=function(element,tail){LightModel._Cons.initializeBase(this);this.$0=element;this.$1=new LightModel.List(tail).asNode();}
LightModel._Cons.prototype={$0:null,$1:null,get_first:function(){return this.$0;},get_second:function(){return this.$1;}}
LightModel.Add=function(){LightModel.Add.initializeBase(this);}
LightModel.Add.prototype={call:function(argument){return new LightModel._Add1(argument).asNode();}}
LightModel._Add1=function(operand){LightModel._Add1.initializeBase(this);this.$0=operand;}
LightModel._Add1.prototype={$0:null,call:function($p0){return new LightModel.NatNumber(LightModel.NatNumber.valueOfNode(this.$0)+LightModel.NatNumber.valueOfNode($p0)).asNode();}}
LightModel.Mod=function(){LightModel.Mod.initializeBase(this);}
LightModel.Mod.prototype={call:function(argument){return new LightModel._Mod1(argument).asNode();}}
LightModel._Mod1=function(operand){LightModel._Mod1.initializeBase(this);this.$0=operand;}
LightModel._Mod1.prototype={$0:null,call:function($p0){var $0=LightModel.NatNumber.valueOfNode(this.$0);var $1=LightModel.NatNumber.valueOfNode($p0);return new LightModel.NatNumber($0%$1).asNode();}}
LightModel.Div=function(){LightModel.Div.initializeBase(this);}
LightModel.Div.prototype={call:function(argument){return new LightModel._Div1(argument).asNode();}}
LightModel._Div1=function(operand){LightModel._Div1.initializeBase(this);this.$0=operand;}
LightModel._Div1.prototype={$0:null,call:function($p0){var $0=LightModel.NatNumber.valueOfNode(this.$0);var $1=LightModel.NatNumber.valueOfNode($p0);return new LightModel.NatNumber(Math.floor($0/$1)).asNode();}}
LightModel.IsZero=function(){LightModel.IsZero.initializeBase(this);}
LightModel.IsZero.prototype={call:function(argument){return LightModel.Bool.getBool(!LightModel.NatNumber.valueOfNode(argument));}}
LightModel.Mul=function(){LightModel.Mul.initializeBase(this);}
LightModel.Mul.prototype={call:function(argument){return new LightModel._Mul1(argument).asNode();}}
LightModel._Mul1=function(operand){LightModel._Mul1.initializeBase(this);this.$0=operand;}
LightModel._Mul1.prototype={$0:null,call:function($p0){return new LightModel.NatNumber(LightModel.NatNumber.valueOfNode(this.$0)*LightModel.NatNumber.valueOfNode($p0)).asNode();}}
LightModel.NatNumber=function(number){LightModel.NatNumber.initializeBase(this);this.set_number(number);}
LightModel.NatNumber.valueOfNode=function(node){node.reduce();if(Type.canCast(node.get_expression(),LightModel.NatNumber)){return (Type.safeCast(node.get_expression(),LightModel.NatNumber)).get_number();}var $0=0;LightModel.Node.createApplication3(node,new LightModel.Hook(null,function($p1_0){
$0++;}).asNode(),node).reduce();return $0;}
LightModel.NatNumber.prototype={$0:0,get_number:function(){return this.$0;},set_number:function(value){this.$0=value;return value;},call:function(argument){return new LightModel._NatNumber1(this.get_number(),argument).asNode();},get_readableHuman:function(){return this.$0.toString();}}
LightModel._NatNumber1=function(number,method){LightModel._NatNumber1.initializeBase(this);this.$0=number;this.$1=method;}
LightModel._NatNumber1.prototype={$0:0,$1:null,call:function($p0){this.$1.reduce();for(var $0=0;$0<this.$0;$0++){$p0=LightModel.Node.createApplication2(this.$1,$p0).get_reducedForm();}return $p0;}}
LightModel.Pow=function(){LightModel.Pow.initializeBase(this);}
LightModel.Pow.prototype={call:function(argument){return new LightModel._Pow1(argument).asNode();}}
LightModel._Pow1=function(operand){LightModel._Pow1.initializeBase(this);this.$0=operand;}
LightModel._Pow1.prototype={$0:null,call:function($p0){var $0=LightModel.NatNumber.valueOfNode(this.$0);var $1=LightModel.NatNumber.valueOfNode($p0);var $2=1;while(!!$1--){$2*=$0;}return new LightModel.NatNumber($2).asNode();}}
LightModel.Pred=function(){LightModel.Pred.initializeBase(this);}
LightModel.Pred.prototype={call:function(argument){var $0=LightModel.NatNumber.valueOfNode(argument);return new LightModel.NatNumber((!$0)?0:($0-1)).asNode();}}
LightModel.Sub=function(){LightModel.Sub.initializeBase(this);}
LightModel.Sub.prototype={call:function(argument){return new LightModel._Sub1(argument).asNode();}}
LightModel._Sub1=function(operand){LightModel._Sub1.initializeBase(this);this.$0=operand;}
LightModel._Sub1.prototype={$0:null,call:function($p0){var $0=LightModel.NatNumber.valueOfNode(this.$0);var $1=LightModel.NatNumber.valueOfNode($p0);return new LightModel.NatNumber(($0<$1)?0:$0-$1).asNode();}}
LightModel.Succ=function(){LightModel.Succ.initializeBase(this);}
LightModel.Succ.prototype={call:function(argument){return new LightModel.NatNumber(LightModel.NatNumber.valueOfNode(argument)+1).asNode();}}
LightModel.Xor=function(){LightModel.Xor.initializeBase(this);}
LightModel.Xor.prototype={call:function(argument){return new LightModel._Xor1(argument).asNode();}}
LightModel._Xor1=function(operand){LightModel._Xor1.initializeBase(this);this.$0=operand;}
LightModel._Xor1.prototype={$0:null,call:function($p0){var $0=LightModel.NatNumber.valueOfNode(this.$0);var $1=LightModel.NatNumber.valueOfNode($p0);return new LightModel.NatNumber($0^$1).asNode();}}
LightModel.Fst=function(){LightModel.Fst.initializeBase(this);}
LightModel.Fst.prototype={call:function(argument){return LightModel.Pair.getFirst(argument);}}
LightModel.MakePair=function(){LightModel.MakePair.initializeBase(this);}
LightModel.MakePair.prototype={call:function(argument){return new LightModel._MakePair1(argument).asNode();}}
LightModel._MakePair1=function(operand){LightModel._MakePair1.initializeBase(this);this.$0=operand;}
LightModel._MakePair1.prototype={$0:null,call:function($p0){return new LightModel.RealPair(this.$0,$p0).asNode();}}
LightModel.Pair=function(){LightModel.Pair.initializeBase(this);}
LightModel.Pair.getFirst=function(node){node.reduce();if(Type.canCast(node.get_expression(),LightModel.Pair)){var $0=Type.safeCast(node.get_expression(),LightModel.Pair);return $0.get_first();}return LightModel.Node.createApplication2(node,LightModel.K.instance).get_reducedForm();}
LightModel.Pair.getSecond=function(node){node.reduce();if(Type.canCast(node.get_expression(),LightModel.Pair)){var $0=Type.safeCast(node.get_expression(),LightModel.Pair);return $0.get_second();}return LightModel.Node.createApplication2(node,LightModel.Node.createApplication2(LightModel.K.instance,LightModel.I.instance)).get_reducedForm();}
LightModel.Pair.prototype={call:function(argument){return LightModel.Node.createApplication3(argument,this.get_first(),this.get_second());},get_readableHuman:function(){return '{'+this.get_first().get_readableHuman()+', '+this.get_second().get_readableHuman()+'}';}}
LightModel.RealPair=function(first,second){LightModel.RealPair.initializeBase(this);this.$0=first;this.$1=second;}
LightModel.RealPair.prototype={$0:null,$1:null,get_first:function(){return this.$0;},get_second:function(){return this.$1;}}
LightModel.Snd=function(){LightModel.Snd.initializeBase(this);}
LightModel.Snd.prototype={call:function(argument){return LightModel.Pair.getSecond(argument);}}
LightModel.S=function(){LightModel.S.initializeBase(this);}
LightModel.S.prototype={call:function(argument){return new LightModel.Node(new LightModel._S1(argument));}}
LightModel._S1=function(x){LightModel._S1.initializeBase(this);this.x=x;}
LightModel._S1.prototype={x:null,call:function($p0){return new LightModel.Node(new LightModel._S2(this.x,$p0));}}
LightModel._S2=function(x,y){LightModel._S2.initializeBase(this);this.x=x;this.y=y;}
LightModel._S2.prototype={x:null,y:null,call:function($p0){return LightModel.Node.createApplication3(this.x,$p0,LightModel.Node.createApplication2(this.y,$p0));}}
LightModel.U=function(){LightModel.U.initializeBase(this);}
LightModel.U.prototype={call:function(argument){return LightModel.Node.createApplication3(argument,LightModel.S.instance,LightModel.K.instance);}}
LightModel._Console=function(){}
LightModel._Console.$2=function($p0){switch($p0){case 0:return '0,0,0';case 9:return '0,0,255';case 11:return '0,255,255';case 1:return '0,0,128';case 3:return '0,128,128';case 8:return '130,130,130';case 2:return '0,128,0';case 5:return '128,0,128';case 4:return '128,0,0';case 6:return '128,128,0';case 7:return '189,189,189';case 10:return '0,255,0';case 13:return '255,0,255';case 12:return '255,0,0';case 15:return '255,255,255';case 14:return '255,255,0';default:return '255,255,255';}}
LightModel._Console.get_$3=function(){return document.getElementById('target');}
LightModel._Console.$4=function($p0){var $0=$p0.toString();$0=$0.replaceAll('\n','<br/>');$0=$0.replaceAll(' ','&nbsp;');var $1=document.createElement('span');$1.style.color='rgb('+LightModel._Console.$2(LightModel._Console.$0)+')';$1.style.backgroundColor='rgb('+LightModel._Console.$2(LightModel._Console.$1)+')';$1.innerHTML=$0;LightModel._Console.get_$3().appendChild($1);}
LightModel._Console.$5=function($p0){LightModel._Console.$4($p0+'<br/>');}
LightModel._Console.$6=function(){LightModel._Console.$5('');}
LightModel._Console.$8=function($p0){var $0=document.createElement('input');var $1=0;$0.addEventListener('keydown',function($p1_0){
if($p1_0.keyCode===13){var $1_0=($0)['value'];$0.parentNode.removeChild($0);LightModel._Console.$5($1_0);LightModel._Console.$7.add($1_0);$p0($1_0);}if(LightModel._Console.$7.length>0){if($p1_0.keyCode===38){$1=($1+LightModel._Console.$7.length-1)%LightModel._Console.$7.length;($0)['value']=LightModel._Console.$7[$1];}if($p1_0.keyCode===40){$1=($1+LightModel._Console.$7.length+1)%LightModel._Console.$7.length;($0)['value']=LightModel._Console.$7[$1];}}},true);$0.style.color='rgb('+LightModel._Console.$2(LightModel._Console.$0)+')';$0.style.backgroundColor='rgb('+LightModel._Console.$2(LightModel._Console.$1)+')';LightModel._Console.get_$3().appendChild($0);$0.focus();}
LightModel._Console.$9=function(){}
LightModel._Console.$A=function(){LightModel._Console.get_$3().innerHTML='';LightModel._Console.$0=7;LightModel._Console.$1=0;}
LightModel.Expression=function(){}
LightModel.Expression.prototype={get_reducible:function(){return false;},reduce:function(){throw new Error('not supported');},fullReduce:function(){throw new Error('not supported');},asNode:function(){return new LightModel.Node(this);},toString:function(){return this.get_readableHuman();}}
LightModel.Hook=function(name,action){LightModel.Hook.initializeBase(this);this.$1=name;this.$2=action;}
LightModel.Hook.$0=function($p0){}
LightModel.Hook.makeDummy=function(name){return new LightModel.Hook(name,LightModel.Hook.$0);}
LightModel.Hook.prototype={$1:null,$2:null,call:function(argument){this.$2(argument);return argument;}}
LightModel._LazyNode=function(factory){this.$0=factory;this.$1=false;}
LightModel._LazyNode.prototype={$0:null,$1:false,$2:null,get_$3:function(){if(!this.$1){this.$2=this.$0();this.$1=true;}return this.$2;}}
LightModel._Token=function(){}
LightModel._TApp=function(){LightModel._TApp.initializeBase(this);}
LightModel._TApp.prototype={toString:function(){return '.';}}
LightModel._TAssign=function(){LightModel._TAssign.initializeBase(this);}
LightModel._TAssign.prototype={toString:function(){return ' = ';}}
LightModel._TLiteral=function(text){LightModel._TLiteral.initializeBase(this);this.$0=text;}
LightModel._TLiteral.prototype={$0:null,toString:function(){return this.$0;}}
LightModel._TValue=function(value){LightModel._TValue.initializeBase(this);this.$0=value;}
LightModel._TValue.prototype={$0:null,toString:function(){return this.$0.toString();}}
LightModel.LightModel$0=function(f){LightModel.LightModel$0.initializeBase(this);this.$0=f;}
LightModel.LightModel$0.prototype={$0:null,call:function($p0){return this.$0($p0);},get_complexity:function(){return 1;},get_readableHuman:function(){return '<internal>';},get_reducible:function(){return true;}}
LightModel.Node=function(expression){this.set_expression(expression);}
LightModel.Node.parse=function(expression){var $0=[];var $1=expression.split("'")[0]+' ';for(var $5=0;$5<$1.length;$5++){$0.enqueue($1.charAt($5));}var $2=LightModel.Node.$1($0);var $3=[];while(!!$2.length){$3.add($2.dequeue());}var $4=null;if($3.length>2&&Type.canCast($3[1],LightModel._TAssign)){$4=(Type.safeCast($3[0],LightModel._TLiteral)).$0;$3.removeRange(0,2);}if($3.length>0){var $6=$3.getEnumerator();var $7=LightModel.Node.$0($6);if($4!=null){LightModel.CombinatorEnvironment.defaultX.set_item($4,$7);}return $7;}else{return LightModel.I.instance;}}
LightModel.Node.$0=function($p0){var $0=[];while($p0.moveNext()){if(Type.canCast($p0.current,LightModel._TApp)){var $1=$0.pop();var $2=$0.pop();$0.push(LightModel.Node.createApplication2($2,$1));}if(Type.canCast($p0.current,LightModel._TValue)){$0.push((Type.safeCast($p0.current,LightModel._TValue)).$0);}if(Type.canCast($p0.current,LightModel._TLiteral)){$0.push(LightModel.Node.createApplication2(LightModel.I.instance,LightModel.CombinatorEnvironment.defaultX.get_item((Type.safeCast($p0.current,LightModel._TLiteral)).$0)));}}if($0.length!==1){throw new Error('bad format');}return $0.pop();}
LightModel.Node.$1=function($p0){var $0=[];LightModel.Node.$6($p0);var $1=0;while(!!$p0.length){switch($p0.peek()){case '.':$p0.dequeue();$1--;if($1<=0){throw new Error('app parity issue');}$0.enqueue(new LightModel._TApp());break;case '=':$p0.dequeue();$0.enqueue(new LightModel._TAssign());break;default:var $2=LightModel.Node.$7($p0);$1++;if($2!=null){$0.enqueue(new LightModel._TLiteral($2));}else{var $3=LightModel.Node.$8($p0)||LightModel.Node.$9($p0);if($3!=null){$0.enqueue(new LightModel._TValue($3));}else{throw new Error('invalid literal format');}}break;}LightModel.Node.$6($p0);}return $0;}
LightModel.Node.$2=function($p0){return $p0===' '||$p0==='\t'||$p0==='\n'||$p0==='\r';}
LightModel.Node.$3=function($p0){return $p0==='_'||('a'<=$p0&&$p0<='z')||('A'<=$p0&&$p0<='Z');}
LightModel.Node.$4=function($p0){return '0'<=$p0&&$p0<='9';}
LightModel.Node.$5=function($p0){return LightModel.Node.$3($p0)||LightModel.Node.$4($p0);}
LightModel.Node.$6=function($p0){while(LightModel.Node.$2($p0.peek())){$p0.dequeue();}}
LightModel.Node.$7=function($p0){if(!LightModel.Node.$3($p0.peek())&&$p0.peek()!==':'){return null;}var $0=$p0.dequeue();while(LightModel.Node.$5($p0.peek())){$0+=$p0.dequeue();}return $0;}
LightModel.Node.$8=function($p0){if(!LightModel.Node.$4($p0.peek())){return null;}var $0=$p0.dequeue();while(LightModel.Node.$4($p0.peek())){$0+=$p0.dequeue();}return new LightModel.NatNumber(parseInt($0)).asNode();}
LightModel.Node.$9=function($p0){if($p0.peek()!=='"'){return null;}$p0.dequeue();var $0='';while($p0.peek()!=='"'){$0+=$p0.dequeue();}$p0.dequeue();var $1=new LightModel.RealPair(LightModel.Bool.falseX,LightModel.I.instance);for(var $2=$0.length-1;$2>=0;$2--){$1=new LightModel.RealPair(LightModel.Bool.trueX,new LightModel.RealPair(new LightModel.NatNumber($0.charCodeAt($2)).asNode(),$1.asNode()).asNode());}return $1.asNode();}
LightModel.Node.createApplication2=function(a,b){return new LightModel.Application([a,b]).asNode();}
LightModel.Node.createApplication3=function(a,b,c){return new LightModel.Application([a,b,c]).asNode();}
LightModel.Node.createApplication4=function(a,b,c,d){return new LightModel.Application([a,b,c,d]).asNode();}
LightModel.Node.createApplication5=function(a,b,c,d,e){return new LightModel.Application([a,b,c,d,e]).asNode();}
LightModel.Node.createApplication=function(nodes){return new LightModel.Application(nodes).asNode();}
LightModel.Node.$C=function($p0,$p1){while($p1.get_reducible()){(function(){
var $1_0=$p1;var $1_1=Type.safeCast($p1.get_expression(),LightModel.Application);$p0.push(function(){
var $2_0=$1_1.get_a().get_expression().call($1_1.get_b());$p0.push(function(){
$1_0.set_expression($2_0.get_expression());});LightModel.Node.$C($p0,$2_0);});$p1=$1_1.get_a();})();}}
LightModel.Node.prototype={$A:null,get_expression:function(){return this.$A;},set_expression:function(value){this.$A=value;return value;},get_reducible:function(){return (this.get_expression()==null)?false:this.get_expression().get_reducible();},get_reducedForm:function(){this.reduce();return this;},reduce:function(){LightModel.Node.$D++;var $0=LightModel.Node.$B.length;if(!$0){LightModel.Node.$F=Date.get_now();}var $1=0;LightModel.Node.$B.push(ss.Delegate.create(this,function(){
LightModel.Node.$C(LightModel.Node.$B,this);}));while(LightModel.Node.$B.length>$0){LightModel.Node.$B.pop()();$1=Math.max($1,LightModel.Node.$B.length-$0);if((Date.get_now()-LightModel.Node.$F)>10000){LightModel.Node.$B.clear();LightModel._Console.$5('!BREAK: took more than 10s');return;}}var $2=Date.get_now();var $3=($2-LightModel.Node.$F);if(LightModel.Node.$D>LightModel.Node.$E&&LightModel.Node.$D>1000){LightModel._Console.$5('!Crit real rec: '+LightModel.Node.$D+' frames');}if($1>1000){LightModel._Console.$5('!Crit virt rec: '+$1+' frames');}LightModel.Node.$E=Math.max(LightModel.Node.$E,LightModel.Node.$D);LightModel.Node.$D--;},equalsX:function(obj){return obj!=null&&obj.get_expression()===this.get_expression();},get_readableHuman:function(){return this.get_expression().get_readableHuman();},toString:function(){return this.get_readableHuman();},get_complexity:function(){return this.get_expression().get_complexity();},boost:function(alternative){if(!(Type.canCast(this.get_expression(),LightModel.BuiltInExpression))){this.set_expression(new LightModel.Application([LightModel.Hook.dummy.asNode(),alternative]));}},getOutput:function(){var $0=LightModel.List.valueOfNode(this).getEnumerator();var $1='';while($0.moveNext()){$1+=String.fromCharCode(LightModel.NatNumber.valueOfNode($0.current));if($1.length>1024){return $1+'[...]';}}return $1;},reduceAndShout:function(){LightModel._Console.$5(this.getOutput().htmlEncode());}}
LightModel.Program=function(){}
LightModel.Program.$0=function($p0){var $0=String.fromChar($p0,1);return $0.charCodeAt(0);}
LightModel.Program.$1=function($p0){var $0=String.fromCharCode($p0);return $0.charAt(0);}
LightModel.Program.$2=function($p0){return (!$p0)?'zero':'Succ ('+LightModel.Program.$2($p0-1)+')';}
LightModel.Program.$3=function($p0){return (!$p0)?'listEmpty':'listAddFront('+LightModel.Program.$3($p0.substr(1))+')('+LightModel.Program.$2(LightModel.Program.$0($p0.charAt(0)))+')';}
LightModel.Program.main=function(showAll){LightModel._Console.$A();LightModel.CombinatorEnvironment.defaultX=new LightModel.CombinatorEnvironment();LightModel.CombinatorEnvironment.defaultX.$0();var $0=Date.get_now();var $1=LightModel.I.instance;LightModel._Console.$0=14;if(showAll){LightModel._Console.$5('---Startup---');}LightModel._Console.$0=7;try{if(showAll){LightModel._Console.$5('Loading environment...');}LightModel.CombinatorEnvironment.defaultX.set_item(':',new LightModel.Node(new LightModel.Hook(':',function($p1_0){
$p1_0.reduceAndShout();})));LightModel.CombinatorEnvironment.defaultX.set_item('U',LightModel.U.instance);LightModel.CombinatorEnvironment.defaultX.set_item('I',LightModel.I.instance);LightModel.CombinatorEnvironment.defaultX.set_item('S',LightModel.S.instance);LightModel.CombinatorEnvironment.defaultX.set_item('K',LightModel.K.instance);LightModel.CombinatorEnvironment.defaultX.set_item('B',LightModel.B.instance);LightModel.CombinatorEnvironment.defaultX.set_item('C',LightModel.C.instance);var $2=LightModel.Program.$7();var $3=$2.length;var $4=0;var $5=null;$5=function(){
if($4===$3){LightModel.Program.$5(showAll);}else{var $1_0=$2[$4];try{LightModel.Node.parse($1_0);document.title='stage0: '+$4+'/'+$3;}catch($1_1){LightModel._Console.$5('Parsing fail at: '+$1_0);}$4++;window.setTimeout($5,0);}};$5();}catch($6){LightModel._Console.$0=12;LightModel._Console.$5('Startup failed.');LightModel._Console.$0=7;return;}}
LightModel.Program.$4=function($p0){var $0=LightModel.List.fromString($p0);var $1=LightModel.Node.createApplication2(LightModel.CombinatorEnvironment.defaultX.get_item('maybeReturn'),LightModel.CombinatorEnvironment.defaultX.asNode());var $2=LightModel.Node.createApplication3(LightModel.CombinatorEnvironment.defaultX.get_item('execReduceX'),$1,$0);if(LightModel.Bool.valueOfNode(LightModel.Pair.getFirst($2))){return LightModel.Pair.getSecond($2);}throw new Error('x-parsing error');}
LightModel.Program.$5=function($p0){var $0=Date.get_now();LightModel.CombinatorEnvironment.defaultX.boost('U',LightModel.U.instance);LightModel.CombinatorEnvironment.defaultX.boost('S',LightModel.S.instance);LightModel.CombinatorEnvironment.defaultX.boost('K',LightModel.K.instance);LightModel.CombinatorEnvironment.defaultX.boost('I',LightModel.I.instance);LightModel.CombinatorEnvironment.defaultX.boost('B',LightModel.B.instance);LightModel.CombinatorEnvironment.defaultX.boost('C',LightModel.C.instance);LightModel.CombinatorEnvironment.defaultX.boost('isZero',LightModel.IsZero.instance);LightModel.CombinatorEnvironment.defaultX.boost('zero',new LightModel.NatNumber(0).asNode());LightModel.CombinatorEnvironment.defaultX.boost('one',new LightModel.NatNumber(1).asNode());LightModel.CombinatorEnvironment.defaultX.boost('Succ',LightModel.Succ.instance);LightModel.CombinatorEnvironment.defaultX.boost('Pred',LightModel.Pred.instance);LightModel.CombinatorEnvironment.defaultX.boost('Add',LightModel.Add.instance);LightModel.CombinatorEnvironment.defaultX.boost('Mul',LightModel.Mul.instance);LightModel.CombinatorEnvironment.defaultX.boost('Pow',LightModel.Pow.instance);LightModel.CombinatorEnvironment.defaultX.boost('Sub',LightModel.Sub.instance);LightModel.CombinatorEnvironment.defaultX.boost('Mod',LightModel.Mod.instance);LightModel.CombinatorEnvironment.defaultX.boost('Div',LightModel.Div.instance);LightModel.CombinatorEnvironment.defaultX.boost('Xor',LightModel.Xor.instance);LightModel.CombinatorEnvironment.defaultX.boost('fst',LightModel.Fst.instance);LightModel.CombinatorEnvironment.defaultX.boost('snd',LightModel.Snd.instance);LightModel.CombinatorEnvironment.defaultX.boost('makePair',LightModel.MakePair.instance);LightModel.CombinatorEnvironment.defaultX.boost('TRUE',LightModel.Bool.trueX);LightModel.CombinatorEnvironment.defaultX.boost('FALSE',LightModel.Bool.falseX);LightModel.CombinatorEnvironment.defaultX.boost('NOT',LightModel.Not.instance);LightModel.CombinatorEnvironment.defaultX.boost('AND',LightModel.And.instance);LightModel.CombinatorEnvironment.defaultX.boost('OR',LightModel.Or.instance);var $2=LightModel.Hook.makeDummy('d1').asNode();var $3=LightModel.Hook.makeDummy('d2').asNode();var $4=LightModel.CombinatorEnvironment.defaultX.get_item('K');var $5=LightModel.CombinatorEnvironment.defaultX.get_item('I');if($p0){LightModel._Console.$5('Running assertions...');}LightModel.Program.$6($2.equalsX(LightModel.Node.createApplication2(LightModel.CombinatorEnvironment.defaultX.get_item('I'),$2).get_reducedForm()),'Unexpected behaviour: I');LightModel.Program.$6($2.equalsX(LightModel.Node.createApplication3(LightModel.CombinatorEnvironment.defaultX.get_item('K'),$2,$3).get_reducedForm()),'Unexpected behaviour: K');LightModel.Program.$6($2.equalsX(LightModel.Node.createApplication4(LightModel.CombinatorEnvironment.defaultX.get_item('S'),$4,$5,$2).get_reducedForm()),'Unexpected behaviour: S');LightModel.Program.$6($2.equalsX(LightModel.Node.createApplication5(LightModel.CombinatorEnvironment.defaultX.get_item('B'),$4,$5,$2,$3).get_reducedForm()),'Unexpected behaviour: B');LightModel.Program.$6($2.equalsX(LightModel.Node.createApplication4(LightModel.CombinatorEnvironment.defaultX.get_item('C'),$4,$3,$2).get_reducedForm()),'Unexpected behaviour: C');if($p0){LightModel._Console.$5('Running performance tests...');}for(var $6=0;$6<3;$6++){$0=Date.get_now();LightModel.CombinatorEnvironment.defaultX.set_item('strHello',LightModel.List.fromString('Hello'));LightModel.CombinatorEnvironment.defaultX.set_item('strWorld',LightModel.List.fromString('World'));if($p0){LightModel._Console.$0=10;LightModel._Console.$4('Test execution time (run #'+($6+1)+'): '+(Date.get_now()-$0)+'ms');LightModel._Console.$0=7;LightModel._Console.$6();}}if($p0){LightModel._Console.$5('Startup done.');LightModel._Console.$6();LightModel._Console.$6();LightModel._Console.$0=14;LightModel._Console.$5('---Quick intro---');LightModel._Console.$0=7;LightModel._Console.$5('Expression syntax: see prelude on the right (parsed by same logic as prompt)');LightModel._Console.$5('Available native commands: see prelude on the right');LightModel._Console.$5('Special command: ":" will print value of argument, interpreted as a string');LightModel._Console.$5('Press link above to reload prelude after you changed it.');LightModel._Console.$5('Attention: although this JS-version has far less cheating applied than possible, it still has. Changing a prelude-expression getting cheated on afterwards has no effect (e.g. you may redefine TRUE without any effect)!');LightModel._Console.$6();LightModel._Console.$0=14;LightModel._Console.$5('---Example expressions---');LightModel._Console.$0=15;var $7=[];$7.add(': (strFromN (Succ one))');$7.add(': (listCons "Hello" (listAddFront "World" 32))');var $enum1=ss.IEnumerator.getEnumerator($7);while($enum1.moveNext()){var $8=$enum1.current;LightModel._Console.$5('> '+$8);LightModel._Console.$0=10;LightModel.Program.$4($8).reduce();LightModel._Console.$0=15;}LightModel._Console.$6();LightModel._Console.$0=14;LightModel._Console.$5('---Lambada prompt---');LightModel._Console.$0=15;}var $1=null;$1=function(){
LightModel._Console.$0=15;LightModel._Console.$4('> ');LightModel._Console.$8(function($p2_0){
var $2_0=null;LightModel._Console.$0=10;try{$2_0=LightModel.Program.$4($p2_0);$2_0.reduce();}catch($2_1){LightModel._Console.$5('INVALID COMMAND! '+$2_1);}$1();});};$1();}
LightModel.Program.$6=function($p0,$p1){if(!$p0){throw new Error($p1);}}
LightModel.Program.$7=function(){var $0=document.getElementById('stage0');var $1=($0)['value'];var $2=$1.split('\n');return $2;}
LightModel.Expression.registerClass('LightModel.Expression');LightModel.Application.registerClass('LightModel.Application',LightModel.Expression);LightModel.BuiltInExpression.registerClass('LightModel.BuiltInExpression',LightModel.Expression);LightModel.CombinatorEnvironment.registerClass('LightModel.CombinatorEnvironment',LightModel.Expression);LightModel.B.registerClass('LightModel.B',LightModel.BuiltInExpression);LightModel._B1.registerClass('LightModel._B1',LightModel.BuiltInExpression);LightModel._B2.registerClass('LightModel._B2',LightModel.BuiltInExpression);LightModel.And.registerClass('LightModel.And',LightModel.BuiltInExpression);LightModel._And1.registerClass('LightModel._And1',LightModel.BuiltInExpression);LightModel.Bool.registerClass('LightModel.Bool',LightModel.BuiltInExpression);LightModel._Bool1.registerClass('LightModel._Bool1',LightModel.BuiltInExpression);LightModel.Not.registerClass('LightModel.Not',LightModel.BuiltInExpression);LightModel.Or.registerClass('LightModel.Or',LightModel.BuiltInExpression);LightModel._Or1.registerClass('LightModel._Or1',LightModel.BuiltInExpression);LightModel.C.registerClass('LightModel.C',LightModel.BuiltInExpression);LightModel._C1.registerClass('LightModel._C1',LightModel.BuiltInExpression);LightModel._C2.registerClass('LightModel._C2',LightModel.BuiltInExpression);LightModel.I.registerClass('LightModel.I',LightModel.BuiltInExpression);LightModel.K.registerClass('LightModel.K',LightModel.BuiltInExpression);LightModel._K1.registerClass('LightModel._K1',LightModel.BuiltInExpression);LightModel.ListTail.registerClass('LightModel.ListTail',LightModel.BuiltInExpression);LightModel.ListHead.registerClass('LightModel.ListHead',LightModel.BuiltInExpression);LightModel.ListSkip.registerClass('LightModel.ListSkip',LightModel.BuiltInExpression);LightModel._ListSkip1.registerClass('LightModel._ListSkip1',LightModel.BuiltInExpression);LightModel.TailEnumerable.registerClass('LightModel.TailEnumerable');LightModel.TailEnumerator.registerClass('LightModel.TailEnumerator');LightModel.DeferredTailEnumerable.registerClass('LightModel.DeferredTailEnumerable');LightModel.DeferredTailEnumerator.registerClass('LightModel.DeferredTailEnumerator');LightModel.Pair.registerClass('LightModel.Pair',LightModel.BuiltInExpression);LightModel.List.registerClass('LightModel.List',LightModel.Pair);LightModel._Cons.registerClass('LightModel._Cons',LightModel.Pair);LightModel.Add.registerClass('LightModel.Add',LightModel.BuiltInExpression);LightModel._Add1.registerClass('LightModel._Add1',LightModel.BuiltInExpression);LightModel.Mod.registerClass('LightModel.Mod',LightModel.BuiltInExpression);LightModel._Mod1.registerClass('LightModel._Mod1',LightModel.BuiltInExpression);LightModel.Div.registerClass('LightModel.Div',LightModel.BuiltInExpression);LightModel._Div1.registerClass('LightModel._Div1',LightModel.BuiltInExpression);LightModel.IsZero.registerClass('LightModel.IsZero',LightModel.BuiltInExpression);LightModel.Mul.registerClass('LightModel.Mul',LightModel.BuiltInExpression);LightModel._Mul1.registerClass('LightModel._Mul1',LightModel.BuiltInExpression);LightModel.NatNumber.registerClass('LightModel.NatNumber',LightModel.BuiltInExpression);LightModel._NatNumber1.registerClass('LightModel._NatNumber1',LightModel.BuiltInExpression);LightModel.Pow.registerClass('LightModel.Pow',LightModel.BuiltInExpression);LightModel._Pow1.registerClass('LightModel._Pow1',LightModel.BuiltInExpression);LightModel.Pred.registerClass('LightModel.Pred',LightModel.BuiltInExpression);LightModel.Sub.registerClass('LightModel.Sub',LightModel.BuiltInExpression);LightModel._Sub1.registerClass('LightModel._Sub1',LightModel.BuiltInExpression);LightModel.Succ.registerClass('LightModel.Succ',LightModel.BuiltInExpression);LightModel.Xor.registerClass('LightModel.Xor',LightModel.BuiltInExpression);LightModel._Xor1.registerClass('LightModel._Xor1',LightModel.BuiltInExpression);LightModel.Fst.registerClass('LightModel.Fst',LightModel.BuiltInExpression);LightModel.MakePair.registerClass('LightModel.MakePair',LightModel.BuiltInExpression);LightModel._MakePair1.registerClass('LightModel._MakePair1',LightModel.BuiltInExpression);LightModel.RealPair.registerClass('LightModel.RealPair',LightModel.Pair);LightModel.Snd.registerClass('LightModel.Snd',LightModel.BuiltInExpression);LightModel.S.registerClass('LightModel.S',LightModel.BuiltInExpression);LightModel._S1.registerClass('LightModel._S1',LightModel.BuiltInExpression);LightModel._S2.registerClass('LightModel._S2',LightModel.BuiltInExpression);LightModel.U.registerClass('LightModel.U',LightModel.BuiltInExpression);LightModel._Console.registerClass('LightModel._Console');LightModel.Hook.registerClass('LightModel.Hook',LightModel.BuiltInExpression);LightModel._LazyNode.registerClass('LightModel._LazyNode');LightModel._Token.registerClass('LightModel._Token');LightModel._TApp.registerClass('LightModel._TApp',LightModel._Token);LightModel._TAssign.registerClass('LightModel._TAssign',LightModel._Token);LightModel._TLiteral.registerClass('LightModel._TLiteral',LightModel._Token);LightModel._TValue.registerClass('LightModel._TValue',LightModel._Token);LightModel.LightModel$0.registerClass('LightModel.LightModel$0',LightModel.Expression);LightModel.Node.registerClass('LightModel.Node');LightModel.Program.registerClass('LightModel.Program');LightModel.CombinatorEnvironment.defaultX=new LightModel.CombinatorEnvironment();LightModel.B.instance=new LightModel.B().asNode();LightModel.And.instance=new LightModel.And().asNode();LightModel.Bool.trueX=new LightModel.Bool(true).asNode();LightModel.Bool.falseX=new LightModel.Bool(false).asNode();LightModel.Not.instance=new LightModel.Not().asNode();LightModel.Or.instance=new LightModel.Or().asNode();LightModel.C.instance=new LightModel.C().asNode();LightModel.I.instance=new LightModel.I().asNode();LightModel.K.instance=new LightModel.K().asNode();LightModel.ListTail.instance=new LightModel.ListTail().asNode();LightModel.ListHead.instance=new LightModel.ListHead().asNode();LightModel.ListSkip.instance=new LightModel.ListSkip().asNode();LightModel.List.emptyList=new LightModel.List([]).asNode();LightModel.Add.instance=new LightModel.Add().asNode();LightModel.Mod.instance=new LightModel.Mod().asNode();LightModel.Div.instance=new LightModel.Div().asNode();LightModel.IsZero.instance=new LightModel.IsZero().asNode();LightModel.Mul.instance=new LightModel.Mul().asNode();LightModel.Pow.instance=new LightModel.Pow().asNode();LightModel.Pred.instance=new LightModel.Pred().asNode();LightModel.Sub.instance=new LightModel.Sub().asNode();LightModel.Succ.instance=new LightModel.Succ().asNode();LightModel.Xor.instance=new LightModel.Xor().asNode();LightModel.Fst.instance=new LightModel.Fst().asNode();LightModel.MakePair.instance=new LightModel.MakePair().asNode();LightModel.Snd.instance=new LightModel.Snd().asNode();LightModel.S.instance=new LightModel.S().asNode();LightModel.U.instance=new LightModel.U().asNode();LightModel._Console.$0=7;LightModel._Console.$1=0;LightModel._Console.$7=[];LightModel.Hook.dummy=LightModel.Hook.makeDummy('dummy');LightModel.Node.$B=[];LightModel.Node.$D=0;LightModel.Node.$E=0;LightModel.Node.$F=null;})();// This script was generated using Script# v0.7.4.0
